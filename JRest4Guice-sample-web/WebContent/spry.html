<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:spry="http://ns.adobe.com/spry">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>联系人管理</title>
<script type="text/javascript" src="javascript/lib/jquery-1.2.2.js"></script>
<script language="JavaScript" type="text/javascript" src="javascript/spry/SpryData.js"></script>
<script language="JavaScript" type="text/javascript" src="javascript/spry/SpryJSONDataSet.js"></script>
<script language="JavaScript" type="text/javascript" src="javascript/spry/SpryNestedJSONDataSet.js"></script>
<script type="text/javascript">
	contacts_ds = new Spry.Data.JSONDataSet();
	contact_detail_ds = new Spry.Data.JSONDataSet();

	function deleteContact(id,name){
		if(!window.confirm("你确定要删除\""+name+"\"?"))
			return;
		$.ajax({
			url:"resource/contact/"+id,
			type:"DELETE",
			dataType:'json',
			success:function(json){
				if(!json.errorMessage)
					contacts_ds.loadData();
				else
					alert(json.errorMessage);
			}
		})	
	}
	
	function init(){
		contacts_ds.setURL("resource/contacts?first=1&max=100");
		contacts_ds.useCache = false;
		contacts_ds.setPath("content");
		contacts_ds.setRequestInfo({useCache:false,headers:{"Accept":"application/json"},sortOnLoad:"name"},true);
		contact_detail_ds.setURL("resource/contact/{contacts_ds::id}");
		contact_detail_ds.setPath("content");
		contact_detail_ds.setRequestInfo({headers:{"Accept":"application/json"}},true);
		
		contacts_ds.loadData();
	}

</script>
<style>
	.myHoverClass {background-color:yellow;} 
	.mySelectClass {color: white;background-color:red;} 
</style>
</head>
<body>
	<button onclick="init();">Load ...</button>
	<div style="float: left;width:55%;margin-right: 50px;" spry:region="contacts_ds">
		<table id="contactList" cellpadding="0" background="#ffffff" cellspacing="0" width="100%">
			<thead style="font-weight: bold;">
				<tr style="background-color:#f0ffe6;height: 24px;">
					<td style="width: 60px;" spry:sort="name">&nbsp;姓 名</td>
					<td style="width: 120px;">&nbsp;移动电话</td>
					<td style="width: 130px;">&nbsp;电子邮件</td>
					<td>&nbsp;家庭住址</td>
					<td style="width: 60px;">&nbsp;操作</td>
				</tr>
			</thead>
			<tbody>
				<tr id="tr_{id}" spry:repeat="contacts_ds" spry:hover="myHoverClass" 
					spry:select="mySelectClass" spry:setrow="contacts_ds" style="cursor: pointer;">
					<td>&nbsp;{name}</td>
					<td>&nbsp;{mobilePhone}</td>
					<td>&nbsp;{EMail}</td>
					<td>&nbsp;{address}</td>
					<td>&nbsp;<button onclick="deleteContact('{id}','{name}');">删除</button></td>
				</tr>
			</tbody>
		</table>
	</div>
	
	<div style="width: 38%;float: right;">
		<div id="editArea1" spry:detailregion="contact_detail_ds">
			<input style="display: none;" type="text" name="id" value="{id}">
			<div>
				<div style="margin-top: 8px;clear: both;"><b>姓名：</b></div><input type="text" name="name" value="{name}"><br>
			</div>
			<div>
				<div style="margin-top: 8px;clear: both;"><b>移动电话：</b></div><input type="text" name="mobilePhone" value="{mobilePhone}"><br>
			</div>
		</div>
		<div id="editArea2" spry:detailregion="contact_detail_ds">
			<div>
				<div style="margin-top: 8px;clear: both;"><b>电子邮件：</b></div><input type="text" name="EMail" value="{EMail}"><br>
			</div>
			<div>
				<div style="margin-top: 8px;clear: both;"><b>家庭住址：</b></div><textarea rows="4" cols="30" name="address">{address}</textarea><br>
			</div>
			<br/>
			<button onclick="doSave(true);">确定</button>  or  <a href="#" onclick="doCancel();void(0);return false;">取消</a>
		</div>

	</div>
</body>
</html>